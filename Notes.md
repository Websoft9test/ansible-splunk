#  Splunk Enterprise Notes ==test

组件名称：Splunk Enterprise 
安装文档：https://docs.splunk.com/Documentation/Splunk/8.0.3/Installation/InstallonLinux  
配置文档: https://docs.splunk.com/Documentation/Splunk/8.0.3/Admin/RunSplunkassystemdservice 
支持平台：Debian家族 | RHEL家族 | Windows |macOS   

责任人：zeng xiang chuan

## 概要

Splunk Enterprise 是领先的实时运维智能平台,是一个托管的日志文件管理工具。

## 环境要求

* 程序语言：  spl语言
* 应用服务器： 无
* 数据库：无
* 依赖组件：python  mongod  
* 其他：

## 安装说明

本项目采用源码包编译安装。

下面基于不同的安装平台，分别进行安装说明。

### CentOS  

```shell
#官网下载splunk rpm源码包
wget https://download.splunk.com/products/splunk/releases/8.0.3/linux/splunk-8.0.3-a6754d8441bf-linux-2.6-x86_64.rpm

#安装splunk
rpm -ivh splunk-8.0.3-a6754d8441bf-linux-2.6-x86_64.rpm

#启动脚本(实现非交互,自动接受许可证,设置管理员密码)
vim splunkinstall.sh
#!/bin/bash
splunk_dir="/opt"
splunk_user="splunk"
splunk_password="123456"
[ -f /usr/bin/expect ] || yum -y install expect
/usr/bin/expect << EOF
set timeout 200
spawn ${splunk_dir}/splunk/bin/splunk start --accept-license
expect "username"
send "${splunk_user}\r"
expect "password"
send "${splunk_password}\r"
expect "password"
send "${splunk_password}\r"
set timeout 200
expect eof
exit
EOF

#编写服务  设置开机自启
systemctl daemon-reload
systemctl enable splunk


```

### Ubuntu 

```shell
#官网下载splunk deb源码包
wget https://download.splunk.com/products/splunk/releases/8.0.3/linux/splunk-8.0.3-a6754d8441bf-linux-2.6-amd64.deb

#安装splunk
dpkg -i splunk-8.0.3-a6754d8441bf-linux-2.6-amd64.deb

#启动脚本
vim splunkinstall.sh
#!/bin/bash
splunk_dir="/opt"
splunk_user="splunk_user"
splunk_password="splunk_password"
[ -f /usr/bin/expect ] || apt -y install expect
/usr/bin/expect << EOF
set timeout 200
spawn ${splunk_dir}/splunk/bin/splunk start --accept-license
expect "username"
send "${splunk_user}\r"
expect "password"
send "${splunk_password}\r"
expect "password"
send "${splunk_password}\r"
set timeout 200
expect eof
exit
EOF


```

## 路径

* 程序路径：/opt/splunk/bin/splunk
* 日志路径： /opt/splunk/var/log/splunk/
* 配置文件路径：/opt/splunk/etc/system/default
* 其他...

## 配置

进入web页面设置许可证:
settings-->Licensing-->Add license

## 账号密码


### 数据库密码

如果有数据库  
无

* 数据库安装方式：
* 账号密码：

### 后台账号

如果有后台账号

* 登录地址  http://Your ip:8000
* 账号密码  启动时自定义
* 密码修改方案：最好是有命令行修改密码的方案
  进入web页面更改密码

## 服务

本项目安装后自动生成：

备注：本项目安装后无服务,需自行编写服务

服务文件位置：/etc/systemd/system/splunk.service

```
#This unit file replaces the traditional start-up script for systemd
#configurations, and is used when enabling boot-start for Splunk on
#systemd-based Linux distributions.

[Unit]
Description=Systemd service file for Splunk, generated by 'splunk enable boot-start'
After=network.target

[Service]
Type=simple
Restart=always
ExecStart=/opt/splunk/bin/splunk _internal_launch_under_systemd
KillMode=mixed
KillSignal=SIGINT
TimeoutStopSec=360
LimitNOFILE=65536
SuccessExitStatus=51 52
RestartPreventExitStatus=51
RestartForceExitStatus=52
Delegate=true
CPUShares=1024
MemoryLimit=32892018688

[Install]
WantedBy=multi-user.target
                        

```

## 环境变量

cat <<EOF>> /etc/profile
export SPLUNK_HOME=/opt/splunk
export PATH=\$SPLUNK_HOME/bin:\$PATH
EOF

## 版本号

通过如下的命令获取主要组件的版本号: 

```
# Check geoserver version
 cat /opt/splunk/etc/splunk.version
```

## 常见问题

#### 有没有管理控制台？

*http://Your ip:8000*即可访问控制台

#### 本项目需要开启哪些端口？

| item      | port |
| --------- | ---- |
| splunkd   | 8080 |
| python3.7 | 8065 |
| mongod    | 8191 |
| splunkd   | 8089 |

#### 有没有CLI工具？

有     Splunk CLI
CLI命令的常规语法为:   ./splunk <命令> [<对象>] [[-<参数>] <值>] ...

## 日志

* 安装完许可证后需要重启机器才能生效
* ubuntu上使用dpkg安装deb包时需耐心等待一段时间
* ubuntu上找不到expect包时需要将源更新,升级
* 启动systemd时,需要先手动关闭splunk: /opt/splunk/bin/splunk stop,再重启服务

* 2020-05-20完成CentOS安装研究